<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>GPT</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        #loader {
            display: none;
            position: fixed;
            z-index: 9999;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.7);
            text-align: center;
        }

        #loader div {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .content-box {
            border: 2px solid #c9c9c9;
            box-shadow: 1px 1px 11px 7px #d5d5d5;
            background: ghostwhite;
            border-radius: 10px;
        }

        .mail-heading {
            line-height: 27px;
            padding-bottom: 25px;
        }

        p {
            font-family: serif;
            letter-spacing: 1px;
            font-size: 20px;
        }
    </style>
    <script>
        function showLoader() {
            document.getElementById("loader").style.display = "block";
        }


        function hideLoader() {
            document.getElementById("loader").style.display = "none";
        }
    </script>
</head>
<body>

<div id="loader">
    <div class="spinner-grow text-danger " role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>

<div class="container-fluid mt-3 p-5">
    <div class="row">
        <div class="col-md-6 p-5">
            <form th:action="@{/upload}" method="post" class="mt-5" enctype="multipart/form-data"
                  onsubmit="showLoader()">
                <div class=" my-5 ">
                    <input type="file" class="form-control shadow-none border-danger" id="pdfFile" name="pdfFile">
                </div>
                <div class=" my-5">
                    <input type="text" class="form-control shadow-none border-danger" id="prompt"
                           placeholder="Enter Prompt"
                           name="prompt"
                           required>
                </div>
                <div class="my-3">
                    <input type="password" class="form-control shadow-none" name="password"
                           placeholder="PDF password if required">
                </div>
                <div class="my-5 d-grid text-center">
                    <button type="submit" class="btn btn-primary">ASK</button>

                </div>
            </form>
            <div th:if="${error}" class="my-5 p-5">
                <h3 class="text-secondary">Error </h3>
                <p class="text-danger"><code th:text="${error}"></code></p>
            </div>

            <div th:if="${response}">
                <h3 class="text-secondary">Response </h3>
                <p class="text-secondary" th:text="${response}"></p>
            </div>
        </div>


        <div class="content-box col-md-6 p-5 my-5">
            <div class="pb-5" style="display: flex;justify-content: space-around;align-items: flex-start;">
                <h5 class="text-primary text-uppercase p-2 ">All Mails</h5>
                <a th:href="@{/gmail/emails}" class="text-decoration-none"><button class="btn btn-primary text-uppercase ">Get Email</button></a>
            </div>
            <div class="accordion accordion-flush" id="accordionFlushExample">
                <div class="accordion-item" th:each="email,i : ${emails}"
                     style="    border: 2px solid lightgray;">
                    <h2 class="accordion-header" th:id="'flush-heading' + ${i.index+1}">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                th:data-bs-target="'#flush-collapse' + ${i.index+1}" aria-expanded="false"
                                aria-controls="flush-collapseOne" th:text="${email.get('from')}">
                        </button>
                    </h2>
                    <div th:id="'flush-collapse' + ${i.index+1}" class="accordion-collapse collapse"
                         th:aria-labelledby="'flush-heading' + ${i.index+1}"
                         data-bs-parent="#accordionFlushExample">
                        <div class="accordion-body" th:text="${email.get('snippet')}"></div>
                        <span th:text="${email.get('attachments')}"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function simulateResponse() {
        setTimeout(function () {
            hideLoader();
        }, 9000);
    }

    document.querySelector('form').addEventListener('submit', simulateResponse);
</script>

</body>
</html>
